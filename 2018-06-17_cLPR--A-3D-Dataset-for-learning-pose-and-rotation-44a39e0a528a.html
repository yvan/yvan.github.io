<!DOCTYPE html><html><head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-175038637-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      gtag('config', 'UA-175038637-1');
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>cLPR: A 3D Dataset for learning pose and rotation</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">cLPR: A 3D Dataset for learning pose and rotation</h1>
</header>
<section data-field="subtitle" class="p-summary">
Today I’m releasing the cLPR dataset, a dataset for doing work in 3D machine learning. The name stands for Cubes for Learning Pose and…
</section>
<section data-field="body" class="e-content">
<section name="c2bb" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="540a" id="540a" class="graf graf--h3 graf--leading graf--title">cLPR: A 3D Dataset for learning pose and rotation</h3><p name="6279" id="6279" class="graf graf--p graf-after--h3">Today I’m releasing the <em class="markup--em markup--p-em">cLPR </em>dataset, a dataset for doing work in 3D machine learning. The name stands for <strong class="markup--strong markup--p-strong">Cubes</strong> for <strong class="markup--strong markup--p-strong">Learning</strong> <strong class="markup--strong markup--p-strong">Pose</strong> and <strong class="markup--strong markup--p-strong">Rotation</strong>. The goal is to provide a nice baseline dataset of colored 3D cubes in many different positions for testing machine learning algorithms whose goal is to learn about pose and rotation.</p><figure name="05e8" id="05e8" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 508px; max-height: 552px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 108.7%;"></div><img class="graf-image" data-image-id="1*Gkh92gqGMOHt1S7_pSGsMA.gif" data-width="508" data-height="552" src="img/1_Gkh92gqGMOHt1S7_pSGsMA.gif"></div></figure><p name="abdb" id="abdb" class="graf graf--p graf-after--figure">Download the dataset here:</p><p name="e235" id="e235" class="graf graf--p graf-after--p"><a href="https://bit.ly/2yeeA15" data-href="https://bit.ly/2yeeA15" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://bit.ly/2yeeA15</a></p><h4 name="fd40" id="fd40" class="graf graf--h4 graf-after--p">The Data</h4><p name="e94b" id="e94b" class="graf graf--p graf-after--h4">The dataset contains 32x32, 64x64, 128x128, 256x256 jpeg images of a cube (2d projections of the 3d object).The jpegs do not have any quality loss. The data looks like this:</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="3"><figure name="49a0" id="49a0" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 33.333%;"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 100%;"></div><img class="graf-image" data-image-id="1*9di90P-UBKQlqo7HBqs9vw.jpeg" data-width="256" data-height="256" src="img/1_9di90P-UBKQlqo7HBqs9vw.jpeg"></div></figure><figure name="226e" id="226e" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 33.333%;"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 100%;"></div><img class="graf-image" data-image-id="1*sQe17mDL1_fq5VLpFPnAGQ.jpeg" data-width="256" data-height="256" src="img/1_sQe17mDL1_fq5VLpFPnAGQ.jpeg"></div></figure><figure name="b3cf" id="b3cf" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 33.333%;"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 100%;"></div><img class="graf-image" data-image-id="1*xzp4CmxOcsdi4XYbo9ENoQ.jpeg" data-width="256" data-height="256" src="img/1_xzp4CmxOcsdi4XYbo9ENoQ.jpeg"></div><figcaption class="imageCaption" style="width: 300.003%; left: -200.003%;">The cube in 3 different positions. The first and third image are showing 2 of the same sides (red and cyan).</figcaption></figure></div><div class="section-inner sectionLayout--insetColumn"><h4 name="0515" id="0515" class="graf graf--h4 graf-after--figure">The Labels</h4><p name="f111" id="f111" class="graf graf--p graf-after--h4">The labels are provided in the binary numpy file. The file is called <code class="markup--code markup--p-code">cube1–1.14.3–2018–06–10–12–30–10.npy</code>, generally <code class="markup--code markup--p-code">cubeN-x.xx.x-datetime.npy</code> where <code class="markup--code markup--p-code">x.xx.x</code> is the numpy version used to dump the file and <code class="markup--code markup--p-code">N</code> is the cube this data file is for. It contains every position and rotation of the nodes in a cube for all images in the dataset. For this dataset the structure is 250047 x 8 x 6, It’s POSITIONS x NODES x 6 numpy array, where the first 3 values of the last dimension (0,1,2) are x,y,z position and the last 3 values in the last dimention (3,4,5) are x,y,z rotation in radians. You can also just create whatever labels you want by modifying what the script stores in the <code class="markup--code markup--p-code">rotation_positions</code> array (<code class="markup--code markup--p-code">projector.py</code>, line 90).</p><p name="d80f" id="d80f" class="graf graf--p graf-after--p">So the structure looks like:</p><figure name="6f05" id="6f05" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/yvan/43a00343049706ee216706896c17a887.js"></script></figure><h4 name="95f8" id="95f8" class="graf graf--h4 graf-after--figure">Making the Dataset</h4><p name="7e78" id="7e78" class="graf graf--p graf-after--h4">The dataset is produced using a package called <code class="markup--code markup--p-code">pygame</code> which is a package originally designed for making python games. The package is nice because it lets you easily draw and render objects in 2d or 3d. I used pygame because I wanted the code to be easy enough for someone with limited graphics experience and basic knowledge of matrix multiplication to understand.</p><p name="6b1d" id="6b1d" class="graf graf--p graf-after--p">The <a href="https://github.com/yvan/cLPR" data-href="https://github.com/yvan/cLPR" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">code</a> used to generate the dataset is on github. Let’s go over how that code works at a high level.</p><h4 name="e1f7" id="e1f7" class="graf graf--h4 graf-after--p">Step 1 Create a Wireframe</h4><p name="bd56" id="bd56" class="graf graf--p graf-after--h4">First we create a wireframe of the cube. This wireframe consists of nodes, edges, and faces. The nodes are points in space, each represented with x,y,z coordinates. We store all the nodes in an 8x3 numpy array. Edges are two nodes (the indices of the nodes in the numpy array). Faces are 4 nodes connected together (again the indices of the nodes in the numpy array).</p><p name="b49c" id="b49c" class="graf graf--p graf-after--p">You can create a wireframe like this:</p><figure name="dbb5" id="dbb5" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/yvan/081a84f4f4ff5996fc0ab6cba2f0f68f.js"></script></figure><p name="7372" id="7372" class="graf graf--p graf-after--figure">I use this to create 8 nodes, 6 faces. You don’t actually need to specify edges, just nodes and faces. You can test a cube wireframe creation; run <code class="markup--code markup--p-code">python wireframe.py</code> script included in the repository:</p><figure name="de31" id="de31" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/yvan/d9d8223c2515df4d5c3da68a3d6c6293.js"></script></figure><p name="9af8" id="9af8" class="graf graf--p graf-after--figure">For this wireframe class the only outside dependency for <code class="markup--code markup--p-code">wireframe.py</code> is <code class="markup--code markup--p-code">numpy</code>. This script will create a cube and print the nodes, edges, and faces.</p><h4 name="5391" id="5391" class="graf graf--h4 graf-after--p">Step 2 Generate Rotations</h4><p name="f7d7" id="f7d7" class="graf graf--p graf-after--h4">Then I generate a set of rotations I’d like to apply in 3D to the nodes of the cube (the corners of the cube). To generate the rotations I just loop through all possible combinations of rotations from 0-6.3 radians(close to 2π radians but not exactly perfect).</p><figure name="a5d4" id="a5d4" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/yvan/4a210c6f0aba29743b1f9ba84f40b583.js"></script></figure><p name="be85" id="be85" class="graf graf--p graf-after--figure">The above snippet will generate roughly 360 degrees, 2π of rotation in radians. Then every frame/iteration of pygame we will grab one of these rotations and display it.</p><h4 name="43eb" id="43eb" class="graf graf--h4 graf-after--p">Step 3 Render the Wireframe</h4><p name="8914" id="8914" class="graf graf--p graf-after--h4">I render the wireframe using pygame’s functions to draw polygons. The function takes a series of edges (2 points, [(x,y,z), (x,y,z)]) and draws a polygon on screen with that color in the order of the points and edges given. Below is a quick and dirty version of my code; the actual script is a bit more involved.</p><figure name="0f74" id="0f74" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/yvan/9e85bbb4629909e0450a3a82dbc57d64.js"></script></figure><h4 name="7508" id="7508" class="graf graf--h4 graf-after--figure">Step 4 Apply one Rotation and Re-Center the Cube</h4><p name="7e7e" id="7e7e" class="graf graf--p graf-after--h4">To apply a rotation to this cube I use a rotation matrix for the appropriate axis. So to rotate around the <em class="markup--em markup--p-em">x</em> axis I would use <code class="markup--code markup--p-code">create_rot_x</code> from <code class="markup--code markup--p-code">wireframe.py</code>. This function returns a matrix for doing rotations in the <em class="markup--em markup--p-em">x</em> axis for the number of radians we need. Then I just do a dot product in the <code class="markup--code markup--p-code">transform</code> function between the nodes of the wireframe and the rotation matrix we created. All this does is multiply the x,y,z positions of our nodes by the right numbers in the matrix such that the new positions are rotated by however many radians along <em class="markup--em markup--p-em">x</em>. I repeart the above process for <em class="markup--em markup--p-em">x</em>,<em class="markup--em markup--p-em">y</em> and <em class="markup--em markup--p-em">z</em> radians for this rotation. After this is done re-center the cube so its middle is around the center of the screen.</p><figure name="0f07" id="0f07" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/yvan/2161f59162e88ae093de1c6354bbf677.js"></script></figure><h4 name="f960" id="f960" class="graf graf--h4 graf-after--figure">Step 5 Reset the cube nodes to their initial position</h4><p name="5362" id="5362" class="graf graf--p graf-after--h4">I store the initial position and reset it to that after every rotation+re-center+snapshot of the cube. This just makes it easier to reason about what the cube does on every iteration, move to exactly the rotation I give it. Moving from one rotation to another can also have problems with something called gimbal lock. It is a bit of a mind bender so I wanted to avoid it entirely.</p><h4 name="5fd8" id="5fd8" class="graf graf--h4 graf-after--p">Step 6 Repeat Steps 3–5</h4><p name="e91d" id="e91d" class="graf graf--p graf-after--h4">While I do this I screen shot the pygame screen after every rotation and store position information in a numpy array. During the process I write the images to disk and at the end I save a numpy array with all the nodes’ positions and rotations.</p><h4 name="ad1b" id="ad1b" class="graf graf--h4 graf-after--p">Final step</h4><p name="c5e2" id="c5e2" class="graf graf--p graf-after--h4">Visual inspection and programatic testing of labels. I play back the numpy file (the <code class="markup--code markup--p-code">-t</code> input option to <code class="markup--code markup--p-code">projector.py</code> does plyback of npy file) and watch that the rotations look good. Also run it through the <code class="markup--code markup--p-code">test_npy_positions</code> function (the <code class="markup--code markup--p-code">-n</code> input to <code class="markup--code markup--p-code">projector.py</code>) which compares it a against known correct values for the positions at every section. The explanations above are intended to give you a sense of how the code works, see the <a href="https://github.com/yvan/cLPR" data-href="https://github.com/yvan/cLPR" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">code on github</a> for more details. The code is not perfect, neither is the dataset and there’s a lot of room to improve (i.e. adding color mappings to the labels to make tracking easier). Please feel free to make a pull request or hack around on your own. I would really appreciate it.</p><h4 name="f24c" id="f24c" class="graf graf--h4 graf-after--p">What can you do with this dataset?</h4><p name="1a88" id="1a88" class="graf graf--p graf-after--h4">One thing you can do is train variational autoencoders. Just to show an example of how to use this dataset I’ve provided two variational auto encoders (<a href="https://github.com/yvan/cLPR/blob/master/example_dense_vae.ipynb" data-href="https://github.com/yvan/cLPR/blob/master/example_dense_vae.ipynb" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">one classic</a>, <a href="https://github.com/yvan/cLPR/blob/master/example_conv_vae.ipynb" data-href="https://github.com/yvan/cLPR/blob/master/example_conv_vae.ipynb" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">one convlutional</a>). Both are bit, underwhelming … but the point is just to show an example, not to have a perfect model.</p><p name="5fd9" id="5fd9" class="graf graf--p graf-after--p">Below is a picture where each cell represents an area of the latent space I have sampled and then put through our decoder network to generate a cube:</p><figure name="d26c" id="d26c" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 530px; max-height: 530px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 100%;"></div><img class="graf-image" data-image-id="1*Cr4AIULfHjd-HgM9W6595g.jpeg" data-width="530" data-height="530" data-is-featured="true" src="img/1_Cr4AIULfHjd-HgM9W6595g.jpeg"></div></figure><p name="1ee6" id="1ee6" class="graf graf--p graf-after--figure">Not all of these look like cubes, but hey a couple of them do! <a href="https://github.com/yvan/cLPR/blob/master/example_conv_vae.ipynb" data-href="https://github.com/yvan/cLPR/blob/master/example_conv_vae.ipynb" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">The code is in this notebook</a>.</p><p name="f3e2" id="f3e2" class="graf graf--p graf-after--p">Don’t get discouraged. Generative models are notoriously hard and finicky, here’s an example of one of my failed model outputs:</p><figure name="bf64" id="bf64" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 530px; max-height: 530px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 100%;"></div><img class="graf-image" data-image-id="1*NH0bufBAnMUWarr0Qnx07w.jpeg" data-width="530" data-height="530" src="img/1_NH0bufBAnMUWarr0Qnx07w.jpeg"></div><figcaption class="imageCaption">Failed (yet cool) cube outputs.</figcaption></figure><p name="6c05" id="6c05" class="graf graf--p graf-after--figure">Here is the obligatory gif (snapshot at every epoch) of the vae model I made above training on a subsample of the data:</p><figure name="a33f" id="a33f" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 530px; max-height: 530px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 100%;"></div><img class="graf-image" data-image-id="1*6w__LrAJGaIjZPUpgVSL9Q.gif" data-width="530" data-height="530" src="img/1_6w__LrAJGaIjZPUpgVSL9Q.gif"></div><figcaption class="imageCaption">GIF of training VAE</figcaption></figure><p name="8cf5" id="8cf5" class="graf graf--p graf-after--figure">If you would like a much better example of autoencoders trying different distributions in the autoencoder please <a href="https://nicola-decao.github.io/s-vae/" data-href="https://nicola-decao.github.io/s-vae/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">check out this paper</a> (and accompanying github code), written by my friend Tim Davidson at Universiteit van Amsterdam and several of his colleagues. There is also a really cool <a href="https://arxiv.org/abs/1807.04689" data-href="https://arxiv.org/abs/1807.04689" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">paper on SO3 autoencoders</a> using a variant of this dataset.</p><h4 name="57d7" id="57d7" class="graf graf--h4 graf-after--p">Conclusion</h4><p name="8af9" id="8af9" class="graf graf--p graf-after--h4">Thanks for making it to the end. If you find an issue with the dataset or any of the scripts please reach out to me; people are already using this data (pre-release) for research papers and projects so issues should be known, publicized, and debugged.</p><p name="4e00" id="4e00" class="graf graf--p graf-after--p">If you would like to cite this dataset you can do so:</p><pre name="9419" id="9419" class="graf graf--pre graf-after--p">Yvan Scher (2018). cLPR Dataset. Brooklyn, NY: The Internet</pre><pre name="9027" id="9027" class="graf graf--pre graf-after--pre">OR</pre><pre name="d468" id="d468" class="graf graf--pre graf-after--pre">@misc{Scher:2018,<br>author = &quot;Yvan Scher&quot;,<br>year = &quot;2018&quot;,<br>title = &quot;cLPR Dataset&quot;,<br>url = &quot;<a href="https://bit.ly/2yeeA15" data-href="https://bit.ly/2yeeA15" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener noopener" target="_blank">https://bit.ly/2yeeA15</a>&quot;,<br>institution = &quot;The Internet&quot;}</pre><pre name="803c" id="803c" class="graf graf--pre graf-after--pre">OR</pre><pre name="e1ea" id="e1ea" class="graf graf--pre graf-after--pre">Just say you used the cLPR dataset and link back to this post :)</pre><p name="cb77" id="cb77" class="graf graf--p graf-after--pre">I want to thank express my thanks to <a href="http://www.petercollingridge.co.uk" data-href="http://www.petercollingridge.co.uk" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">peter collingridge</a> who has some good pygame tutorials. I have done other <a href="https://medium.com/@yvanscher/how-to-make-a-game-with-pygame-fc85159ae354" data-href="https://medium.com/@yvanscher/how-to-make-a-game-with-pygame-fc85159ae354" class="markup--anchor markup--p-anchor" target="_blank">blogs</a> with pygame if that’s something that interests you. If you want to stay up to date with projects and interesting stuff happening in graphics and ai you should subscribe to my newsletter: <a href="https://tinyletter.com/generationmachine" data-href="https://tinyletter.com/generationmachine" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Generation Machine</em></strong></a>.</p><p name="3e75" id="3e75" class="graf graf--p graf-after--p graf--trailing">Cheers!</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@yvanscher" class="p-author h-card">Yvan Scher</a> on <a href="https://medium.com/p/44a39e0a528a"><time class="dt-published" datetime="2018-06-17T19:17:13.351Z">June 17, 2018</time></a>.</p><p><a href="https://medium.com/@yvanscher/clpr-a-3d-dataset-for-learning-pose-and-rotation-44a39e0a528a" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on June 23, 2020.</p></footer></article></body></html>
