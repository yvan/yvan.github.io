<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Yvan Scher, yvan, scher, yvanscher">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>blog - yvan scher</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/style.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-175038637-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      gtag('config', 'UA-175038637-1');
    </script>
</head>
<body>
  <div id="blog-content-header">
    <p><a href="http://yvanscher.com">Home</a></p>
    <p><a href="http://yvanscher.com/writing">Writing</a></p> 
  </div>
  <div id="blog-content">
    <p>Nov 2017</p>

    <h1>Cellular Automata Caves</h1>
    <!-- <img src="http://yvanscher.com/img/make_a_pygame2/img1.png" target="_blank"/> -->

    <p>Have you ever wanted to create something from nothing? When you are making games, you’ll often find yourself with the desire to autogenerate some part of your game, whether it be a map, character features, or weapon designs. The thing is, randomness is kind of bad. It usually ends up being unwieldy or downright unplayable. This post will teach you a method for generating an infinite number of random but useful game maps. To do this, we will use a generation method called Cellular Automata. Let’s dive in!</p>
    

    <p>Here is a cave generated with almost complete randomness:</p>

    <img src="http://yvanscher.com/img/cellular_automata_caves/img1.png" target="_blank"/>

    <p>Here is the code used to generate this cave:</p>

    <script src="https://gist.github.com/yvan/b402af3eb54724993973c10ef3f81cd3.js"></script>

    <p>In this cave, dots are traversable cave floor, and hashtags are non-traversable cave walls. You’ll notice some open spaces here, but it is unlikely this cave would be fun to use in your game; this cave is pretty awful. What we’d like is for there to be interesting features on the map, but we don’t want to hardcode the features. With Cellular Automata, you create a set of simple rules to follow that can produce features of the sort we want.</p>

    <p><h2>Changing the floor spawn rate</h2></p>

    <p>We want more room to walk around to be more floors than walls in our cave (not a 50/50 split).</p>
    <p>RULE: Set the spawn rate of walls to 40% and floors to 60%.</p>

    <script src="https://gist.github.com/yvan/815963d237ad204e90c886a178f3adf8.js"></script>

    <p>Here is the cave our new rule makes:</p>

    <img src="http://yvanscher.com/img/cellular_automata_caves/img2.png" target="_blank"/>

    <p>The difference may appear subtle, but there are more connected spaces, and the open spaces are larger. While this rule has improved our cave, it’s still pretty unplayable. We want the walls to be more focused, and we want the walking areas to be more contiguous.</p>

    <p><h2>Consolidating walls and floors</h2></p>

    <p>RULE: If there are between 5–7 walls nearby, make the current point a wall.</p>

    <p>Let’s write some code to capture these rules in python:</p>

    <script src="https://gist.github.com/yvan/a4119d743579c5d936edc06c66f91e43.js"></script>

    <p>Here is the map generated by our script:</p>

    <img src="http://yvanscher.com/img/cellular_automata_caves/img3.png" target="_blank"/>

    <p>As you can see, this map looks pretty good. Let’s update the rules for before generation 5:</p>
    <p>RULE: Make a point into a wall if we are on the edge of the map before generation 5.</p>

    <script src="https://gist.github.com/yvan/d25f0201de2ad7be6579fddb50c9e719.js"></script>

    <p>This can produce even better maps:</p>

    <img src="http://yvanscher.com/img/cellular_automata_caves/img4.png" target="_blank"/>

    <p>It has nooks, crannies, even islands, thicker walls, which makes sense because we added a bunch on every iteration. It’s also pretty fast to produce! Is this method perfect? No. It’s more art than science, and you’ll notice that the maps are pretty uninteresting below a certain dimension. Sometimes the maps are still too open. You can play with the different cutoffs, generations, and rules. You will see our method is extremely sensitive to changing any parameter. We can adjust our rules to fix that, but I’ll leave experimentation to the reader. I encourage you to mess around with parameters and to try changing or adding rules.</p>

    <p><h2>Conclusion</h2></p>

    <p>We started with a random map and then applied some rules to turn that randomness into a structured map. You can also start with some structure and add randomness to it. A great example of this can be found in the indie title spelunky, with some of the best pseudo-random level designs. Here is a video of how spelunky starts with some structure and adds randomness to make each level unique! Enjoy!</p>
    
    <p>If you enjoyed this post, be sure to signup for more.</p>

    <p>
    <!-- Begin Mailchimp Signup Form -->
    <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
    <div id="mc_embed_signup">
      <form action="https://hyperclone.us16.list-manage.com/subscribe/post?u=00b2cee03ebf76d80c40ce951&amp;id=9e611a04cd" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
	<div id="mc_embed_signup_scroll">
	  <p>Signup For More</p>
	  <div class="mc-field-group">
	    <!-- <label for="mce-EMAIL">Email</label> -->
	    <input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
	  </div>
	  <div id="mce-responses" class="clear">
	    <div class="response" id="mce-error-response" style="display:none"></div>
	    <div class="response" id="mce-success-response" style="display:none"></div>
	  </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
	  <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_00b2cee03ebf76d80c40ce951_9e611a04cd" tabindex="-1" value=""></div>
	  <div class="clear">
	    <input type="submit" value="Signup" name="subscribe" id="mc-embedded-subscribe" class="button">
	  </div>
	</div>
      </form>
    </div>
    <!--End mc_embed_signup-->
    </p>
  </div>
</body>
</html>
